<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="A deep dive into Data Formulator's backend architecture, exploring how it uses AI to transform and analyze data">
    <meta name="author" content="Your Name">
    <meta name="keywords" content="Data Formulator, AI, Data Analysis, Python, Flask, Backend Architecture">
    
    <title>Data Formulator Backend Architecture: A Deep Dive into AI-Powered Data Analysis</title>
    
    <style>
        :root {
            --primary-color: #2563eb;
            --secondary-color: #1e40af;
            --text-color: #1f2937;
            --code-bg: #f3f4f6;
            --border-color: #e5e7eb;
            --bg-color: #ffffff;
            --header-bg: #f8fafc;
            --accent-color: #3b82f6;
            --link-color: #2563eb;
            --code-color: #6b7280;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            line-height: 1.8;
            color: var(--text-color);
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
        }

        header {
            background: var(--header-bg);
            padding: 4rem 0;
            margin-bottom: 2rem;
            border-bottom: 1px solid var(--border-color);
        }

        .header-content {
            max-width: 800px;
            margin: 0 auto;
            text-align: center;
        }

        .post-meta {
            color: var(--code-color);
            font-size: 0.9rem;
            margin: 1rem 0;
        }

        .post-meta span {
            margin: 0 1rem;
        }

        article {
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem 0;
        }

        h1, h2, h3 {
            color: var(--primary-color);
            line-height: 1.3;
        }

        h1 { 
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }

        h2 { 
            font-size: 2rem;
            margin: 3rem 0 1.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--border-color);
        }

        h3 { 
            font-size: 1.5rem;
            margin: 2rem 0 1rem;
            color: var(--secondary-color);
        }

        p {
            margin: 1.5rem 0;
            font-size: 1.1rem;
        }

        pre {
            background-color: var(--code-bg);
            padding: 1.5rem;
            border-radius: 0.5rem;
            overflow-x: auto;
            font-family: 'Fira Code', 'Courier New', monospace;
            font-size: 0.9rem;
            line-height: 1.5;
            margin: 2rem 0;
            border: 1px solid var(--border-color);
        }

        code {
            background-color: var(--code-bg);
            padding: 0.2rem 0.4rem;
            border-radius: 0.25rem;
            font-family: 'Fira Code', 'Courier New', monospace;
            font-size: 0.9em;
            color: var(--code-color);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 2rem 0;
            font-size: 0.95rem;
        }

        th, td {
            padding: 1rem;
            border: 1px solid var(--border-color);
            text-align: left;
        }

        th {
            background-color: var(--code-bg);
            font-weight: 600;
        }

        .nav {
            position: fixed;
            top: 2rem;
            right: 2rem;
            background: white;
            padding: 1.5rem;
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            max-width: 250px;
        }

        .nav-title {
            font-weight: 600;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--border-color);
        }

        .nav a {
            display: block;
            color: var(--link-color);
            text-decoration: none;
            padding: 0.5rem 0;
            font-size: 0.95rem;
            transition: color 0.2s;
        }

        .nav a:hover {
            color: var(--accent-color);
        }

        .emoji {
            font-size: 1.2em;
            margin-right: 0.5rem;
            display: inline-block;
            vertical-align: middle;
        }

        blockquote {
            margin: 2rem 0;
            padding: 1rem 2rem;
            border-left: 4px solid var(--accent-color);
            background-color: var(--header-bg);
            font-style: italic;
        }

        ul, ol {
            padding-left: 2rem;
            margin: 1.5rem 0;
        }

        li {
            margin: 0.5rem 0;
        }

        .highlight {
            background-color: #fff8dc;
            padding: 0.2rem 0.4rem;
            border-radius: 0.25rem;
        }

        .data-sources-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }

        .data-source {
            background: var(--header-bg);
            padding: 1.5rem;
            border-radius: 0.5rem;
            border: 1px solid var(--border-color);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .data-source:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .data-source h4 {
            margin: 0 0 1rem 0;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .data-source p {
            margin: 0;
            color: var(--text-color);
            font-size: 0.95rem;
        }

        .workflow-example {
            background: var(--header-bg);
            padding: 2rem;
            border-radius: 0.5rem;
            margin: 2rem 0;
        }

        .workflow-steps {
            margin-top: 1.5rem;
        }

        .workflow-steps ol {
            counter-reset: workflow-counter;
            list-style: none;
            padding-left: 0;
        }

        .workflow-steps li {
            counter-increment: workflow-counter;
            position: relative;
            padding: 1rem 1rem 1rem 3rem;
            margin: 1rem 0;
            background: white;
            border-radius: 0.5rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .workflow-steps li::before {
            content: counter(workflow-counter);
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            background: var(--primary-color);
            color: white;
            width: 1.5rem;
            height: 1.5rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .workflow-steps pre {
            margin: 1rem 0;
            background: var(--code-bg);
        }

        .patterns-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin: 2rem 0;
        }

        .pattern-card {
            background: var(--header-bg);
            padding: 2rem;
            border-radius: 0.5rem;
            border: 1px solid var(--border-color);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .pattern-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .pattern-card h3 {
            margin: 0 0 1rem 0;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .pattern-card p {
            margin: 1rem 0;
            color: var(--text-color);
        }

        .pattern-card ul {
            margin: 0;
            padding-left: 1.5rem;
        }

        .pattern-card li {
            margin: 0.5rem 0;
        }

        .summary-box {
            background: var(--header-bg);
            padding: 2rem;
            border-radius: 0.5rem;
            margin: 2rem 0;
            text-align: center;
        }

        .summary-intro {
            font-size: 1.2rem;
            margin-bottom: 2rem;
        }

        .feature-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }

        .feature-item {
            background: white;
            padding: 1.5rem;
            border-radius: 0.5rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            text-align: left;
        }

        .feature-item .emoji {
            font-size: 1.5rem;
            margin: 0;
        }

        .feature-content h4 {
            margin: 0 0 0.5rem 0;
            color: var(--primary-color);
        }

        .feature-content p {
            margin: 0;
            font-size: 0.95rem;
            color: var(--text-color);
        }

        .summary-footer {
            font-size: 1.2rem;
            margin-top: 2rem;
            color: var(--primary-color);
        }

        @media (max-width: 1024px) {
            .nav {
                display: none;
            }
            
            .container {
                padding: 0 1rem;
            }
            
            h1 { font-size: 2rem; }
            h2 { font-size: 1.75rem; }
            h3 { font-size: 1.25rem; }
        }
    </style>
</head>
<body>
    <header>
        <div class="header-content">
            <h1>Data Formulator Backend Architecture: A Deep Dive into AI-Powered Data Analysis</h1>
            <div class="post-meta">
                <span>📅 October 23, 2025</span>
                <span>⏱️ 15 min read</span>
                <span>🏷️ Architecture, AI, Data Analysis</span>
            </div>
        </div>
    </header>

    <nav class="nav">
        <div class="nav-title">Table of Contents</div>
        <a href="#architecture">🏗️ Architecture</a>
        <a href="#core-files">📁 Core Files</a>
        <a href="#ai-agents">🤖 AI Agents</a>
        <a href="#data-loaders">🔌 Data Loaders</a>
        <a href="#workflow">🔄 Workflow</a>
        <a href="#patterns">🔑 Patterns</a>
        <a href="#summary">🎯 Summary</a>
    </nav>

    <div class="container">
        <article>
        <section id="overview">
            <h1><span class="emoji">📊</span>Data Formulator Backend - Easy Overview</h1>

            <section id="architecture">
                <h2><span class="emoji">🏗️</span>Architecture Overview</h2>

                <p>The Data Formulator backend is a <strong>Flask-based Python application</strong> that helps users transform, analyze, and visualize data using AI agents. Think of it as a smart data assistant with multiple specialized "brains" (agents) for different tasks.</p>

                <h3>Main Components:</h3>

                <pre class="architecture-diagram"><code>
┌─────────────────────────────────────────────────────────┐
│                     Flask App (app.py)                   │
│  - Session Management                                    │
│  - API Configuration                                     │
│  - Static File Serving                                   │
└─────────────────────────────────────────────────────────┘
                           │
        ┌──────────────────┼──────────────────┐
        │                  │                  │
        ▼                  ▼                  ▼
┌──────────────┐  ┌──────────────┐  ┌──────────────┐
│  Agent Routes│  │ Table Routes │  │  SSE Routes  │
│ (AI Agents)  │  │ (Data Mgmt)  │  │ (Real-time)  │
└──────────────┘  └──────────────┘  └──────────────┘
        │                  │
        ▼                  ▼
┌──────────────┐  ┌──────────────┐
│  AI Models   │  │  DuckDB      │
│ (OpenAI,etc) │  │  Database    │
└──────────────┘  └──────────────┘</code></pre>

---

            </section>

            <section id="core-files">
                <h2><span class="emoji">📁</span>Core Files Breakdown</h2>

                <div class="file-section">
                    <h3><code>app.py</code> - <span class="emoji">🚀</span>The Main Application</h3>
                    
                    <div class="feature-block">
                        <h4>What it does:</h4>
                        <ul>
                            <li>Initializes the Flask web server</li>
                            <li>Manages user sessions (each user gets a unique session ID)</li>
                            <li>Loads environment variables (API keys, configs)</li>
                            <li>Registers three main blueprints (route modules)</li>
                            <li>Serves static files (the frontend)</li>
                        </ul>
                    </div>

                    <div class="feature-block">
                        <h4>Key Functions:</h4>
                        <ul>
                            <li><code>get_session_id()</code> - Creates/retrieves user sessions</li>
                            <li><code>get_app_config()</code> - Provides frontend configuration</li>
                            <li><code>get_example_dataset_list()</code> - Loads sample datasets (gapminder, movies, etc.)</li>
                        </ul>
                    </div>
                </div>

---

                <div class="file-section">
                    <h3><code>agent_routes.py</code> - <span class="emoji">🤖</span>AI Agent Endpoints</h3>
                    
                    <div class="feature-block">
                        <h4>What it does:</h4>
                        <ul>
                            <li>Provides API endpoints to interact with various AI agents</li>
                            <li>Handles model configuration (OpenAI, Azure, Anthropic, Gemini, Ollama)</li>
                            <li>Tests and validates AI models</li>
                            <li>Processes user requests for data transformations, cleaning, sorting, etc.</li>
                        </ul>
                    </div>

                    <div class="feature-block">
                        <h4>Key Endpoints:</h4>
                        <table class="endpoints-table">
                            <thead>
                                <tr>
                                    <th>Endpoint</th>
                                    <th>What It Does</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><code>/check-available-models</code></td>
                                    <td>Scans which AI models are available & working</td>
                                </tr>
                                <tr>
                                    <td><code>/test-model</code></td>
                                    <td>Tests if a specific AI model is responsive</td>
                                </tr>
                                <tr>
                                    <td><code>/process-data-on-load</code></td>
                                    <td>AI suggests data cleaning when loading data</td>
                                </tr>
                                <tr>
                                    <td><code>/derive-data</code></td>
                                    <td>AI transforms data based on natural language</td>
                                </tr>
                                <tr>
                                    <td><code>/refine-data</code></td>
                                    <td>AI refines previous transformations</td>
                                </tr>
                                <tr>
                                    <td><code>/derive-py-concept</code></td>
                                    <td>AI creates Python functions for new columns</td>
                                </tr>
                                <tr>
                                    <td><code>/clean-data</code></td>
                                    <td>AI cleans messy data</td>
                                </tr>
                                <tr>
                                    <td><code>/sort-data</code></td>
                                    <td>AI intelligently sorts data</td>
                                </tr>
                                <tr>
                                    <td><code>/code-expl</code></td>
                                    <td>AI explains generated code</td>
                                </tr>
                                <tr>
                                    <td><code>/query-completion</code></td>
                                    <td>AI helps complete SQL/data queries</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

---

                <div class="file-section">
                    <h3><code>tables_routes.py</code> - <span class="emoji">📊</span>Database Management</h3>
                    
                    <div class="feature-block">
                        <h4>What it does:</h4>
                        <ul>
                            <li>Manages all table/data operations using DuckDB</li>
                            <li>Handles file uploads (CSV, Excel, JSON)</li>
                            <li>Executes queries and provides data samples</li>
                            <li>Integrates with external data sources</li>
                        </ul>
                    </div>

                    <div class="feature-block">
                        <h4>Key Endpoints:</h4>
                        <table class="endpoints-table">
                            <thead>
                                <tr>
                                    <th>Endpoint</th>
                                    <th>What It Does</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><code>/list-tables</code></td>
                                    <td>Lists all tables in user's session</td>
                                </tr>
                                <tr>
                                    <td><code>/create-table</code></td>
                                    <td>Creates table from uploaded file</td>
                                </tr>
                                <tr>
                                    <td><code>/get-table</code></td>
                                    <td>Retrieves paginated table data</td>
                                </tr>
                                <tr>
                                    <td><code>/sample-table</code></td>
                                    <td>Gets random/head/bottom samples</td>
                                </tr>
                                <tr>
                                    <td><code>/query</code></td>
                                    <td>Executes SQL queries</td>
                                </tr>
                                <tr>
                                    <td><code>/analyze</code></td>
                                    <td>Provides statistics (min, max, avg, etc.)</td>
                                </tr>
                                <tr>
                                    <td><code>/delete-table</code></td>
                                    <td>Drops tables or views</td>
                                </tr>
                                <tr>
                                    <td><code>/upload-db-file</code></td>
                                    <td>Uploads a DuckDB file</td>
                                </tr>
                                <tr>
                                    <td><code>/download-db-file</code></td>
                                    <td>Downloads session database</td>
                                </tr>
                                <tr>
                                    <td><code>/reset-db-file</code></td>
                                    <td>Clears session database</td>
                                </tr>
                                <tr>
                                    <td><code>/data-loader/*</code></td>
                                    <td>Connects to external data sources</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

---

                <div class="file-section">
                    <h3><code>sse_routes.py</code> - <span class="emoji">📡</span>Real-Time Communication</h3>
                    
                    <div class="feature-block">
                        <h4>What it does:</h4>
                        <ul>
                            <li>Implements <strong>Server-Sent Events (SSE)</strong> for real-time updates</li>
                            <li>Allows server to push updates to the client without polling</li>
                            <li>Maintains persistent connections with heartbeats</li>
                        </ul>
                    </div>

                    <div class="feature-block">
                        <h4>Key Endpoints:</h4>
                        <table class="endpoints-table">
                            <thead>
                                <tr>
                                    <th>Endpoint</th>
                                    <th>What It Does</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><code>/connect</code></td>
                                    <td>Establishes SSE connection</td>
                                </tr>
                                <tr>
                                    <td><code>/send-message</code></td>
                                    <td>Sends messages to specific sessions</td>
                                </tr>
                                <tr>
                                    <td><code>/broadcast</code></td>
                                    <td>Sends messages to all connected clients</td>
                                </tr>
                                <tr>
                                    <td><code>/status</code></td>
                                    <td>Shows connection status</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

---

                <div class="file-section">
                    <h3><code>db_manager.py</code> - <span class="emoji">🗄️</span>Database Connection Manager</h3>
                    
                    <div class="feature-block">
                        <h4>What it does:</h4>
                        <ul>
                            <li>Manages DuckDB connections per session</li>
                            <li>Each user gets their own isolated database file</li>
                            <li>Provides context managers for safe connection handling</li>
                        </ul>
                    </div>

                    <div class="feature-block">
                        <h4>Key Features:</h4>
                        <ul>
                            <li>Creates temporary database files per session</li>
                            <li>Auto-closes connections to prevent leaks</li>
                            <li>Stores databases in temp directory or custom location</li>
                        </ul>
                    </div>
                </div>

---

                <div class="file-section">
                    <h3><code>py_sandbox.py</code> - <span class="emoji">🔒</span>Safe Code Execution</h3>
                    
                    <div class="feature-block">
                        <h4>What it does:</h4>
                        <ul>
                            <li>Executes AI-generated Python code safely</li>
                            <li>Prevents malicious code from accessing files or system</li>
                            <li>Can run in subprocess (safer) or main process (faster)</li>
                        </ul>
                    </div>

                    <div class="feature-block">
                        <h4>Security Features:</h4>
                        <ul>
                            <li>Blocks file writing</li>
                            <li>Blocks subprocess/system calls</li>
                            <li>Only allows safe Python libraries (pandas, numpy, etc.)</li>
                            <li>Uses audit hooks to monitor dangerous operations</li>
                        </ul>
                    </div>
                </div>
            </section>

---

            <section id="ai-agents">
                <h2><span class="emoji">🤖</span>AI Agents (in <code>/agents</code> folder)</h2>

                <p>The system has <strong>multiple specialized AI agents</strong>, each an expert at one task:</p>

                <div class="feature-block">
                    <table class="agents-table">
                        <thead>
                            <tr>
                                <th>Agent</th>
                                <th>Purpose</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><code>PythonDataTransformationAgent</code></td>
                                <td>Transforms data using Python code</td>
                            </tr>
                            <tr>
                                <td><code>SQLDataTransformationAgent</code></td>
                                <td>Transforms data using SQL queries</td>
                            </tr>
                            <tr>
                                <td><code>PythonDataRecAgent</code></td>
                                <td>Recommends data transformations</td>
                            </tr>
                            <tr>
                                <td><code>SQLDataRecAgent</code></td>
                                <td>Recommends SQL-based transformations</td>
                            </tr>
                            <tr>
                                <td><code>DataLoadAgent</code></td>
                                <td>Helps load and prepare data</td>
                            </tr>
                            <tr>
                                <td><code>DataCleanAgent</code></td>
                                <td>Cleans messy/raw data</td>
                            </tr>
                            <tr>
                                <td><code>PyConceptDeriveAgent</code></td>
                                <td>Creates new calculated columns</td>
                            </tr>
                            <tr>
                                <td><code>ConceptDeriveAgent</code></td>
                                <td>Derives new concepts from data</td>
                            </tr>
                            <tr>
                                <td><code>SortDataAgent</code></td>
                                <td>Intelligently sorts data</td>
                            </tr>
                            <tr>
                                <td><code>CodeExplanationAgent</code></td>
                                <td>Explains generated code</td>
                            </tr>
                            <tr>
                                <td><code>QueryCompletionAgent</code></td>
                                <td>Helps complete queries</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>

---

            <section id="data-loaders">
                <h2><span class="emoji">🔌</span>Data Loaders (in <code>/data_loader</code> folder)</h2>

                <p>Connect to external data sources:</p>

                <div class="feature-block">
                    <div class="data-sources-grid">
                        <div class="data-source">
                            <h4><span class="emoji">🐘</span>PostgreSQL</h4>
                            <p>Connect to PostgreSQL databases</p>
                        </div>
                        <div class="data-source">
                            <h4><span class="emoji">🐬</span>MySQL</h4>
                            <p>Connect to MySQL databases</p>
                        </div>
                        <div class="data-source">
                            <h4><span class="emoji">🔷</span>MSSQL</h4>
                            <p>Connect to SQL Server</p>
                        </div>
                        <div class="data-source">
                            <h4><span class="emoji">📊</span>Kusto</h4>
                            <p>Connect to Azure Data Explorer</p>
                        </div>
                        <div class="data-source">
                            <h4><span class="emoji">☁️</span>S3</h4>
                            <p>Load data from AWS S3 buckets</p>
                        </div>
                        <div class="data-source">
                            <h4><span class="emoji">💫</span>Azure Blob</h4>
                            <p>Load data from Azure Blob Storage</p>
                        </div>
                    </div>
                </div>
            </section>

---

            <section id="workflow">
                <h2><span class="emoji">🔄</span>How It All Works Together</h2>

                <div class="workflow-example">
                    <h3>Example Flow: "Calculate 7-day moving average"</h3>

                    <div class="workflow-steps">
                        <ol>
                            <li>
                                <strong>Frontend</strong> sends request to <code>/api/agent/derive-data</code>
                            </li>
                            <li>
                                <strong>agent_routes.py</strong> receives the request
                            </li>
                            <li>
                                <strong>PythonDataTransformationAgent</strong> is initialized
                            </li>
                            <li>
                                Agent sends prompt to <strong>AI Model</strong> (e.g., GPT-4)
                            </li>
                            <li>
                                AI generates Python code:
                                <pre><code class="language-python">def transform_data(df):
    df['7-day avg'] = df['Cases'].rolling(7).mean()
    return df</code></pre>
                            </li>
                            <li>
                                <strong>py_sandbox.py</strong> executes code safely
                            </li>
                            <li>
                                Results saved to <strong>DuckDB</strong> via <strong>db_manager</strong>
                            </li>
                            <li>
                                Response sent back to frontend
                            </li>
                            <li>
                                <strong>SSE</strong> can push updates in real-time
                            </li>
                        </ol>
                    </div>
                </div>

---

            <section id="patterns">
                <h2><span class="emoji">🔑</span>Key Design Patterns</h2>

                <div class="patterns-grid">
                    <div class="pattern-card">
                        <h3><span class="emoji">🏗️</span>Blueprint Architecture</h3>
                        <p>Flask blueprints organize routes into logical modules:</p>
                        <ul>
                            <li><code>agent_bp</code> - AI operations</li>
                            <li><code>tables_bp</code> - Data management</li>
                            <li><code>sse_bp</code> - Real-time communication</li>
                        </ul>
                    </div>

                    <div class="pattern-card">
                        <h3><span class="emoji">🔒</span>Session Isolation</h3>
                        <p>Each user gets:</p>
                        <ul>
                            <li>Unique session ID</li>
                            <li>Separate DuckDB database</li>
                            <li>Isolated data and transformations</li>
                        </ul>
                    </div>

                    <div class="pattern-card">
                        <h3><span class="emoji">🤖</span>Agent Pattern</h3>
                        <p>Each agent follows the same structure:</p>
                        <ul>
                            <li><code>__init__()</code> - Setup with AI client</li>
                            <li><code>run()</code> - Main execution</li>
                            <li><code>followup()</code> - Iterative refinement</li>
                            <li><code>process_gpt_response()</code> - Handle AI output</li>
                        </ul>
                    </div>

                    <div class="pattern-card">
                        <h3><span class="emoji">🛡️</span>Safety First</h3>
                        <ul>
                            <li>Sandboxed code execution</li>
                            <li>SQL injection prevention</li>
                            <li>Error message sanitization</li>
                            <li>API key protection</li>
                        </ul>
                    </div>
                </div>
            </section>

---

            <section id="summary">
                <h2><span class="emoji">🎯</span>Summary</h2>

                <div class="summary-box">
                    <p class="summary-intro"><strong>In simple terms:</strong> Data Formulator's backend is like a <strong>smart data assistant</strong> that:</p>

                    <div class="feature-list">
                        <div class="feature-item">
                            <span class="emoji">🗄️</span>
                            <div class="feature-content">
                                <h4>Stores your data</h4>
                                <p>in an isolated database (DuckDB)</p>
                            </div>
                        </div>
                        <div class="feature-item">
                            <span class="emoji">🤖</span>
                            <div class="feature-content">
                                <h4>Uses AI</h4>
                                <p>to understand what you want to do with your data</p>
                            </div>
                        </div>
                        <div class="feature-item">
                            <span class="emoji">💻</span>
                            <div class="feature-content">
                                <h4>Generates code</h4>
                                <p>(Python/SQL) to transform your data</p>
                            </div>
                        </div>
                        <div class="feature-item">
                            <span class="emoji">🔒</span>
                            <div class="feature-content">
                                <h4>Safely executes</h4>
                                <p>that code in a sandbox</p>
                            </div>
                        </div>
                        <div class="feature-item">
                            <span class="emoji">📊</span>
                            <div class="feature-content">
                                <h4>Returns results</h4>
                                <p>back to you</p>
                            </div>
                        </div>
                        <div class="feature-item">
                            <span class="emoji">📡</span>
                            <div class="feature-content">
                                <h4>Updates in real-time</h4>
                                <p>via Server-Sent Events (SSE)</p>
                            </div>
                        </div>
                        <div class="feature-item">
                            <span class="emoji">🔌</span>
                            <div class="feature-content">
                                <h4>Connects to external data</h4>
                                <p>when needed</p>
                            </div>
                        </div>
                    </div>

                    <p class="summary-footer">All while keeping your data <strong>private</strong> and <strong>secure</strong>!</p>
                </div>
            </section>
        </article>

        <footer style="text-align: center; margin: 4rem 0; padding: 2rem 0; border-top: 1px solid var(--border-color);">
            <p>
                <strong>About the Author</strong><br>
                Software Engineer passionate about AI and data analysis
            </p>
            <p>
                <a href="#" style="color: var(--link-color); text-decoration: none; margin: 0 1rem;">Twitter</a>
                <a href="#" style="color: var(--link-color); text-decoration: none; margin: 0 1rem;">GitHub</a>
                <a href="#" style="color: var(--link-color); text-decoration: none; margin: 0 1rem;">LinkedIn</a>
            </p>
            <p style="color: var(--code-color); font-size: 0.9rem;">
                © 2025 Data Formulator Blog. All rights reserved.
            </p>
        </footer>
    </div>
</body>
</html>